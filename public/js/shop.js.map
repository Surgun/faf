{"version":3,"sources":["../../src/js/shop.js"],"names":["Shop","purchased","perks","addPerk","reward","push","createSave","save","forEach","p","loadSave","perk","idToPerk","id","find","r","buyPerk","ResourceManager","materialAvailable","goldCost","mat","matAmt","Notifications","perkCost","deductMoney","addMaterial","purchase","refreshShop","refreshProgress","perkCount","length","perkMaxCount","perksByType","type","filter","category","sort","a","b","order","nextUnlocks","notPurchased","canPurchase","nextUp","boughtPerks","Perk","props","Object","assign","HeroManager","gainHero","subtype","WorkerManager","gainWorker","initializeGuilds","DungeonManager","unlockDungeon","actionSlotManager","upgradeSlot","partySize","TownManager","buildingPerk","BankManager","addLevel","FusionManager","bloopSmith","FortuneManager","TinkerManager","MonsterHall","$marketsTab","$","$purchasePerks","$remainingPerks","$boughtPerks","$purchasedPerks","shopDivs","empty","append","createALperk","showRemainingPerks","show","createPurchasedperk","appendTo","hide","d1","addClass","html","name","title","icon","description","d5","data","canBuy","removeClass","d5a","attr","formatWithCommas","miscIcons","gold","formatToUnits","materialIcon","document","on","e","preventDefault","destroyTooltip","perkid","currentTarget"],"mappings":"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","sourcesContent":["\"use strict\";\r\n\r\nconst Shop = {\r\n    purchased : [],\r\n    perks : [],\r\n    addPerk(reward) {\r\n        this.perks.push(reward);\r\n    },\r\n    createSave() {\r\n        const save = {};\r\n        save.perks = [];\r\n        this.perks.forEach(p => save.perks.push(p.createSave()));\r\n        return save;\r\n    },\r\n    loadSave(save) {\r\n        save.perks.forEach(perk => {\r\n            this.idToPerk(perk.id).loadSave(perk);\r\n        });\r\n    },\r\n    idToPerk(id) {\r\n        return this.perks.find(r=>r.id === id);\r\n    },\r\n    buyPerk(id) {\r\n        const perk = this.idToPerk(id);\r\n        if (ResourceManager.materialAvailable(\"M001\") < perk.goldCost || ResourceManager.materialAvailable(perk.mat) < perk.matAmt) {\r\n            Notifications.perkCost();\r\n            return;\r\n        }\r\n        ResourceManager.deductMoney(perk.goldCost);\r\n        ResourceManager.addMaterial(perk.mat,-perk.matAmt)\r\n        perk.purchase();\r\n        refreshShop();\r\n        refreshProgress();\r\n    },\r\n    perkCount() {\r\n        return this.purchased.length;\r\n    },\r\n    perkMaxCount() {\r\n        return this.perks.length;\r\n    },\r\n    perksByType(type) {\r\n        return this.perks.filter(p=>p.category === type).sort((a,b) => a.order-b.order);\r\n    },\r\n    nextUnlocks(type) {\r\n        const notPurchased = this.perks.filter(p=>p.category === type && !p.purchased).sort((a,b) => a.order-b.order)\r\n        return {canPurchase:notPurchased[0],nextUp:notPurchased[1]};\r\n    },\r\n    boughtPerks() {\r\n        return this.perks.filter(p=>p.purchased);\r\n    }\r\n}\r\n\r\nclass Perk {\r\n    constructor (props) {\r\n        Object.assign(this, props);\r\n        this.purchased = false;\r\n    }\r\n    canBuy() {\r\n        return ResourceManager.materialAvailable(\"M001\") >= this.goldCost && ResourceManager.materialAvailable(this.mat) >= this.matAmt;\r\n    }\r\n    purchase() {\r\n        this.purchased = true;\r\n        if (this.type === \"hero\") HeroManager.gainHero(this.subtype);\r\n        if (this.type === \"worker\") {\r\n            WorkerManager.gainWorker(this.subtype);\r\n            initializeGuilds();\r\n        }\r\n        if (this.type === \"dungeon\") DungeonManager.unlockDungeon(this.subtype);\r\n        if (this.type === \"boss\") DungeonManager.unlockDungeon(this.subtype);\r\n        if (this.type === \"craft\") actionSlotManager.upgradeSlot();\r\n        if (this.type === \"adventure\") DungeonManager.partySize += 1;\r\n        if (this.type === \"synth\" && this.subtype === \"open\") TownManager.buildingPerk(\"synth\");\r\n        if (this.type === \"bank\" && this.subtype === \"open\") TownManager.buildingPerk(\"bank\");\r\n        if (this.type === \"bank\" && this.subtype === \"level\") BankManager.addLevel();\r\n        if (this.type === \"cauldron\" && this.subtype === \"open\") TownManager.buildingPerk(\"fusion\");\r\n        if (this.type === \"cauldron\" && this.subtype === \"level\") FusionManager.addLevel();\r\n        if (this.type === \"forge\" && this.subtype === \"open\") TownManager.buildingPerk(\"forge\");\r\n        if (this.type === \"forge\" && this.subtype === \"level\") bloopSmith.addLevel();\r\n        if (this.type === \"fortune\" && this.subtype === \"open\") TownManager.buildingPerk(\"fortune\");\r\n        if (this.type === \"fortune\" && this.subtype === \"level\") FortuneManager.addLevel();\r\n        if (this.type === \"tinker\" && this.subtype === \"open\") TownManager.buildingPerk(\"tinker\");\r\n        if (this.type === \"tinker\" && this.subtype === \"level\") TinkerManager.addLevel();\r\n        if (this.type === \"monster\" && this.subtype === \"open\") TownManager.buildingPerk(\"monster\");\r\n        if (this.type === \"monster\" && this.subtype === \"level\") MonsterHall.addLevel();\r\n    }\r\n    createSave() {\r\n        const save = {};\r\n        save.id = this.id;\r\n        save.purchased = this.purchased;\r\n        return save;\r\n    }\r\n    loadSave(save) {\r\n        this.purchased = save.purchased;\r\n    }\r\n}\r\n\r\nconst $marketsTab = $(\"#marketsTab\");\r\nconst $purchasePerks = $(\"#purchasePerks\");\r\nconst $remainingPerks = $(\"#remainingPerks\");\r\nconst $boughtPerks = $(\"#boughtPerks\");\r\nconst $purchasedPerks = $(\"#purchasedPerks\");\r\n\r\nconst shopDivs = [\r\n    \"Crafting\",\r\n    \"Dungeon\",\r\n    \"Town\",\r\n]\r\n\r\nfunction refreshShop() {\r\n    $purchasePerks.empty();\r\n    $remainingPerks.empty();\r\n    shopDivs.forEach(type => {\r\n        const perks = Shop.nextUnlocks(type);\r\n        $purchasePerks.append(createALperk(perks.canPurchase,type));\r\n        $remainingPerks.append(showRemainingPerks(type));\r\n    })\r\n    const boughtPerks = Shop.boughtPerks();\r\n    if (boughtPerks.length > 0) {\r\n        $purchasedPerks.show();\r\n        $boughtPerks.empty();\r\n        boughtPerks.forEach(perk => {\r\n            createPurchasedperk(perk).appendTo($boughtPerks);\r\n        });\r\n    }\r\n    else $purchasedPerks.hide();\r\n}\r\n\r\nfunction showRemainingPerks(type) {\r\n    const perkCount =  Shop.perksByType(type).length - Shop.perksByType(type).filter(perk => perk.purchased).length;\r\n    if (perkCount <= 2) return;\r\n    const d1 = $(\"<div/>\").addClass(\"alPerkRemaining\");\r\n        $(\"<div/>\").addClass(\"alTitle\").html(`${type} Perks`).appendTo(d1);\r\n        $(\"<div/>\").addClass(\"alPerkCount\").html(`+${perkCount - 2}`).appendTo(d1);\r\n        $(\"<div/>\").addClass(\"alDesc\").html(`More perks available for purchase.`).appendTo(d1);\r\n        $(\"<div/>\").addClass(\"alBuyPrev\").html(`Purchase previous perk to unlock more perks.`).appendTo(d1);\r\n    return d1;\r\n}\r\n\r\nfunction createALperk(perk,name) {\r\n    const d1 = $(\"<div/>\").addClass(\"alPerk\");\r\n    $(\"<div/>\").addClass(\"alTitle\").html(perk.title).appendTo(d1);\r\n    $(\"<div/>\").addClass(\"alSection\").html(`${name} Perk`).appendTo(d1);\r\n    $(\"<div/>\").addClass(\"alImage\").html(perk.icon).appendTo(d1);\r\n    $(\"<div/>\").addClass(\"alDesc\").html(perk.description).appendTo(d1);\r\n    if (perk.purchased) {\r\n        return d1.addClass(\"perkPurchased\");\r\n    }\r\n    const d5 = $(\"<div/>\").addClass(\"alPerkBuy\").data(\"pid\",perk.id).appendTo(d1);\r\n        if (!perk.canBuy()) d5.addClass(\"cannotAfford\");\r\n        else d5.removeClass(\"cannotAfford\");\r\n        $(\"<div/>\").addClass(\"alPerkBuyText\").html(\"Purchase\").appendTo(d5);\r\n        const d5a = $(\"<div/>\").addClass(\"alPerkBuyCost\").appendTo(d5);\r\n            $(\"<div/>\").addClass(\"buyCost tooltip\").attr({\"data-tooltip\": \"gold_value\", \"data-tooltip-value\": formatWithCommas(perk.goldCost)}).html(`${miscIcons.gold} ${formatToUnits(perk.goldCost,2)}`).appendTo(d5a);\r\n            $(\"<div/>\").addClass(\"buyCost tooltip\").addClass(\"shopMat\"+perk.mat).data(\"perkID\",perk.id).attr({\"data-tooltip\": \"material_desc\", \"data-tooltip-value\": perk.mat}).html(`${ResourceManager.materialIcon(perk.mat)} ${perk.matAmt}`).appendTo(d5a);\r\n    return d1;\r\n}\r\n\r\nfunction createPurchasedperk(perk) {\r\n    const d1 = $(\"<div/>\").addClass(\"alPurchasedPerk tooltip\").attr({\"data-tooltip\": \"perk_desc\", \"data-tooltip-value\": perk.id});\r\n    $(\"<div/>\").addClass(\"purchasedPerkTitle\").html(perk.title).appendTo(d1);\r\n    $(\"<div/>\").addClass(\"alSection\").html(`${perk.category} Perk`).appendTo(d1);\r\n    $(\"<div/>\").addClass(\"purchasedPerkImage\").html(perk.icon).appendTo(d1);\r\n    return d1;\r\n}\r\n\r\n//buy a perk\r\n$(document).on(\"click\",\".alPerkBuy\", (e) => {\r\n    e.preventDefault();\r\n    destroyTooltip();\r\n    const perkid = $(e.currentTarget).data(\"pid\");\r\n    Shop.buyPerk(perkid);\r\n});"],"file":"shop.js"}