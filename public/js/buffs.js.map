{"version":3,"sources":["../../src/js/buffs.js"],"names":["buffTemplate","props","Object","assign","Buff","target","power","stacks","stackCast","onCast","Math","min","maxStack","save","id","type","onTick","onHit","onHitting","decrease","BuffRefreshManager","removeBuff","updateBuffCount","BuffManager","buffDB","addBuffTemplate","buff","push","idToBuff","buffID","find","b","generateBuff","hasBuff","getBuff","addCast","BuffLookup","addBuff","generateSaveBuff","hardRefreshBuff","dungeon","DungeonManager","getCurrentDungeon","party","heroes","forEach","ally","$heroDiv","$","uniqueid","empty","buffs","makeBuffContainer","appendTo","mobs","enemy","$enemyDiv","d1","addClass","attr","html","icon","combatant","buffList","append","remove","B0010","B0020","B1010","takeDamage","B1020","B2010","BM200","BM902","BM902A","BM902B","floor","hpmax"],"mappings":"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","sourcesContent":["\"use strict\";\r\n\r\nclass buffTemplate {\r\n    constructor (props) {\r\n        Object.assign(this, props);\r\n    }\r\n}\r\n\r\nclass Buff {\r\n    constructor (buffTemplate,target,power) {\r\n        Object.assign(this, buffTemplate);\r\n        this.stacks = this.stackCast;\r\n        this.target = target;\r\n        this.power = power;\r\n    }\r\n    addCast() {\r\n        if (this.onCast === \"refresh\") {\r\n            this.stacks = this.stackCast;\r\n        }\r\n        else if (this.onCast === \"stack\") {\r\n            this.stacks = Math.min(this.stacks+this.stackCast,this.maxStack);\r\n        }\r\n    }\r\n    createSave() {\r\n        const save = {};\r\n        save.stacks = this.stacks;\r\n        save.power = this.power;\r\n        save.id = this.id;\r\n        return save;\r\n    }\r\n    loadSave(save) {\r\n        this.stacks = save.stacks;\r\n    }\r\n    buffTick(type) {\r\n        if (type === \"onTurn\") this.onTick();\r\n        if (type === \"onHit\") this.onHit();\r\n        if (type === \"onHitting\") this.onHitting();\r\n        if (type !== this.decrease) return;\r\n        this.stacks -= 1;\r\n        if (this.stacks <= 0) BuffRefreshManager.removeBuff(this, this.target);\r\n        else BuffRefreshManager.updateBuffCount(this, this.target);\r\n    }\r\n    expired() {\r\n        return this.stacks <= 0;\r\n    }\r\n    onTick() { return; }\r\n    onHit() { return; }\r\n    onHitting() { return; }\r\n    getPow() { return 0; }\r\n    getTech() { return 0; }\r\n    isChilled() { return false; }\r\n    getProtection() { return 0; }\r\n    maxHP() { return 0; }\r\n}\r\n\r\nconst BuffManager = {\r\n    buffDB : [],\r\n    addBuffTemplate(buff) {\r\n        this.buffDB.push(buff);\r\n    },\r\n    idToBuff(buffID) {\r\n        return this.buffDB.find(b => b.id === buffID);\r\n    },\r\n    generateBuff(buffID,target,power=0) {\r\n        if (target.hasBuff(buffID)) {\r\n            const buff = target.getBuff(buffID);\r\n            buff.addCast();\r\n            BuffRefreshManager.updateBuffCount(buff,target);\r\n            return;\r\n        }\r\n        const buffTemplate = this.idToBuff(buffID);\r\n        const buff = new BuffLookup[buffID](buffTemplate,target,power);\r\n        target.addBuff(buff);\r\n        BuffRefreshManager.addBuff(buff,target);\r\n    },\r\n    removeBuff(buffID,target) {\r\n        if (!target.hasBuff(buffID)) return;\r\n        const buff = target.getBuff(buffID);\r\n        target.removeBuff(buffID);\r\n        BuffRefreshManager.removeBuff(buff,target);\r\n    },\r\n    generateSaveBuff(buffID,target,power) {\r\n        const buffTemplate = this.idToBuff(buffID);\r\n        const buff = new BuffLookup[buffID](buffTemplate,target,power);\r\n        return buff;\r\n    }\r\n}\r\n\r\nconst BuffRefreshManager = {\r\n    //this is responsible for tracking and updating buffs so we don't have to!\r\n    hardRefreshBuff() {\r\n        //populate the divs as they're supposed to be!\r\n        const dungeon = DungeonManager.getCurrentDungeon();\r\n        dungeon.party.heroes.forEach(ally => {\r\n            const $heroDiv = $(\"#buffList\"+ally.uniqueid);\r\n            $heroDiv.empty();\r\n            ally.buffs.forEach(buff => {\r\n                this.makeBuffContainer(buff,ally.uniqueid).appendTo($heroDiv);\r\n            });\r\n        });\r\n        dungeon.mobs.forEach(enemy => {\r\n            const $enemyDiv = $(\"#buffList\"+enemy.uniqueid);\r\n            $enemyDiv.empty();\r\n            enemy.buffs.forEach(buff => {\r\n                this.makeBuffContainer(buff,enemy.uniqueid).appendTo($enemyDiv);\r\n            });\r\n        })\r\n    },\r\n    makeBuffContainer(buff,uniqueid) {\r\n        const d1 = $(\"<div/>\").addClass(\"buffContainer tooltip\").attr(\"id\",\"bc\"+uniqueid+buff.id).attr({\"data-tooltip\": \"buff_desc\", \"data-tooltip-value\": buff.id});;\r\n            $(\"<div/>\").addClass(\"buffContainerIcon\").html(buff.icon).appendTo(d1);\r\n            $(\"<div/>\").addClass(\"buffContainerCount\").attr(\"id\",\"bcount\"+uniqueid+buff.id).html(buff.stacks).appendTo(d1);\r\n        return d1;\r\n    },\r\n    addBuff(buff,combatant) {\r\n        const buffList = $(\"#buffList\"+combatant.uniqueid);\r\n        buffList.append(this.makeBuffContainer(buff,combatant.uniqueid));\r\n    },\r\n    updateBuffCount(buff,combatant) {\r\n        $(\"#bcount\"+combatant.uniqueid+buff.id).html(buff.stacks);\r\n    },\r\n    removeBuff(buff,combatant) {\r\n        $(\"#bc\"+combatant.uniqueid+buff.id).remove();\r\n    }\r\n}\r\n\r\nclass B0010 extends Buff {\r\n    constructor (buffTemplate,target,power) {\r\n        super(buffTemplate,target,power);\r\n    }\r\n    getProtection() {\r\n        return 0.5;\r\n    }\r\n}\r\n\r\nclass B0020 extends Buff {\r\n    constructor (buffTemplate,target,power) {\r\n        super(buffTemplate,target,power);\r\n    }\r\n    maxHP() {\r\n        return this.power*this.stacks;\r\n    }\r\n}\r\n\r\nclass B1010 extends Buff {\r\n    constructor (buffTemplate,target,power) {\r\n        super(buffTemplate,target,power);\r\n    }\r\n    onHitting() {\r\n        this.target.takeDamage(this.power);\r\n    }\r\n}\r\n\r\nclass B1020 extends Buff {\r\n    constructor (buffTemplate,target,power) {\r\n        super(buffTemplate,target,power);\r\n    }\r\n    isChilled() {\r\n        return true;\r\n    }\r\n}\r\n\r\nclass B2010 extends Buff {\r\n    constructor (buffTemplate,target,power) {\r\n        super(buffTemplate,target,power);\r\n    }\r\n    getTech() {\r\n        return this.power;\r\n    }\r\n}\r\n\r\nclass BM200 extends Buff {\r\n    constructor (buffTemplate,target,power) {\r\n        super(buffTemplate,target,power);\r\n    }\r\n    getProtection() {\r\n        return 1;\r\n    }\r\n}\r\n\r\nclass BM902 extends Buff {\r\n    constructor (buffTemplate,target,power) {\r\n        super(buffTemplate,target,power);\r\n    }\r\n    onHitting() {\r\n        this.target.takeDamage(this.power*this.stacks);\r\n    }\r\n}\r\n\r\nclass BM902A extends Buff {\r\n    constructor (buffTemplate,target,power) {\r\n        super(buffTemplate,target,power);\r\n    }\r\n    getProtection() {\r\n        return 0.75;\r\n    }\r\n}\r\n\r\nclass BM902B extends Buff {\r\n    constructor (buffTemplate,target,power) {\r\n        super(buffTemplate,target,power);\r\n    }\r\n    maxHP() {\r\n        return -Math.floor(this.target.hpmax/10)*this.stacks;\r\n    }\r\n}\r\n\r\nconst BuffLookup = {\r\n    B0010,\r\n    B0020, \r\n    B1010,\r\n    B1020,\r\n    B2010,\r\n    BM200,\r\n    BM902,\r\n    BM902A,\r\n    BM902B,\r\n}"],"file":"buffs.js"}